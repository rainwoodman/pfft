<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Advanced Features &mdash; PFFT 1.0.8 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="PFFT 1.0.8 documentation" href="index.html" />
    <link rel="next" title="Interface Layers of the PFFT Library" href="interface.html" />
    <link rel="prev" title="Installation and linking" href="install.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="interface.html" title="Interface Layers of the PFFT Library"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation and linking"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PFFT 1.0.8 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>[2]ifpackageloaded#1#2 [2]ifpackageloaded#1#2 [3]ifpackageloaded#1#2#3</p>
<p>#1</p>
<div class="section" id="advanced-features">
<h1>Advanced Features<a class="headerlink" href="#advanced-features" title="Permalink to this headline">¶</a></h1>
<div class="section" id="how-to-deal-with-fft-index-shifts-in-parallel">
<h2>How to Deal with FFT Index Shifts in Parallel<a class="headerlink" href="#how-to-deal-with-fft-index-shifts-in-parallel" title="Permalink to this headline">¶</a></h2>
<p>Let <span class="math">\(n\in2{\ensuremath{\mathbb{N}}}\)</span>. A common problem is that the
index of the FFT input and/or output array runs between
<span class="math">\(-\nicefrac n2,\dots,\nicefrac n2-1\)</span>, but the FFT library requires
them to run between <span class="math">\(0,\dots,n-1\)</span>. With serial program execution
one can easily remap the input data <span class="math">\(\hat g_k\)</span> in a way that is
suitable for the library, i.e.,</p>
<div class="math">
\[\hat f_k := \hat g_{(k-\nicefrac n2\bmod n)}, \quad k = 0,\dots,n-1.\]</div>
<p>Similarly, one could remap the outputs of the library <span class="math">\(f_l\)</span>,
<span class="math">\(l=0,\cdots,n-1\)</span> in the opposite direction in order to get the
required outputs, i.e.,</p>
<div class="math">
\[g_l := f_{l \bmod n}, \quad l = -\nicefrac n2,\dots,\nicefrac n2-1.\]</div>
<p>These shifts are also known as <code class="docutils literal"><span class="pre">fftshift</span></code> in Matlab.</p>
<p>However, with distributed memory these <code class="docutils literal"><span class="pre">fftshift</span></code> operations require
more complex data movements and result in a global communication. For
example, the first index of the array moves to the middle and,
therefore, the corresponding data move to another MPI process.
Fortunately, this communication can be avoided at the cost of little
extra computation. At the end of the section we present two PFFT library
functions that perform the necessary pre- and postprocessing for shifted
input and output index sets.</p>
<div class="section" id="shift-with-half-the-fft-size">
<h3>Shift with half the FFT size<a class="headerlink" href="#shift-with-half-the-fft-size" title="Permalink to this headline">¶</a></h3>
<p>The special case of input shift <span class="math">\(k_s=-\nicefrac n2\)</span> and/or output
shift <span class="math">\(l_s=-\nicefrac n2\)</span> is supported by PFFT. User can choose to
shift the input (<code class="docutils literal"><span class="pre">PFFT_SHIFTED_IN</span></code>) and/or to shift the output
(<code class="docutils literal"><span class="pre">PFFT_SHIFTED_OUT</span></code>).</p>
<p>Here, we are interested in the computation of</p>
<div class="math">
\[g_l = \sum_{k=-\nicefrac{n_i}{2}}^{\nicefrac{n_i}{2}-1} \hat g_k {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} kl/n}}}, \quad l=-\nicefrac{n_o}{2},\dots,\nicefrac{n_o}{2}-1\]</div>
<p>with <span class="math">\(n, n_i, n_o \in 2{\ensuremath{\mathbb{N}}}\)</span> and
<span class="math">\(n&gt;n_i\)</span>, <span class="math">\(n&gt;n_o\)</span>.</p>
<p>With an index shift of <span class="math">\(\nicefrac n2\)</span> both in <span class="math">\(k\)</span> and
<span class="math">\(l\)</span> this equivalent to the computation of</p>
<div class="math">
\[\begin{split}\begin{aligned}
  g_{(l-\nicefrac{n}{2})}
  &amp;= \sum_{k=\nicefrac{n}{2}-\nicefrac{n_i}{2}}^{\nicefrac{n}{2}+\nicefrac{n_i}{2}-1}
     \hat g_{(k-\nicefrac{n}{2})} {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} (k-\nicefrac n2)(l-\nicefrac n2)/n}}} \\
  &amp;= {{\ensuremath{\mathrm{e}}}}^{+\pi{\ensuremath{\text{\scriptsize{i}}}}l}
       \sum_{k=\nicefrac{n}{2}-\nicefrac{n_i}{2}}^{\nicefrac{n}{2}+\nicefrac{n_i}{2}-1}
       \left(\hat g_{(k-\nicefrac{n}{2})}{{\ensuremath{\mathrm{e}}}}^{+\pi{\ensuremath{\text{\scriptsize{i}}}}(k-\nicefrac n2)}\right) {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} kl/n}}} \\
  &amp;= {{\ensuremath{\mathrm{e}}}}^{+\pi{\ensuremath{\text{\scriptsize{i}}}}(l-\nicefrac n2)}
     \underbrace{
       \sum_{k=\nicefrac{n}{2}-\nicefrac{n_i}{2}}^{\nicefrac{n}{2}+\nicefrac{n_i}{2}-1}
       \underbrace{\left(\hat g_{(k-\nicefrac{n}{2})}{{\ensuremath{\mathrm{e}}}}^{+\pi{\ensuremath{\text{\scriptsize{i}}}}k}\right)}_{\hat f_k} {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} kl/n}}}
     }_{f_l}\end{aligned}\end{split}\]</div>
<p>for
:math:` l=nicefrac n2-nicefrac{n_o}{2},dots,nicefrac n2 +nicefrac{n_o}{2}-1`.
Therefore, we get the following algorithm</p>
<div class="math">
\[f_l = \sum_{k=0}^n \hat g_k {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} kl/n}}}, \quad l=-\nicefrac{n_o}{2},\dots,\nicefrac{n_o}{2}-1\]</div>
<p>The special case <span class="math">\(k_s=-\frac{n_i}{2}, l_s=-\frac{n_o}{2}\)</span>
corresponds to the shifts the arrays ()</p>
<p>[1] =1.1ex For <span class="math">\(k=0,\dots,n-1\)</span> set <span class="math">\(\hat f_k = 0\)</span>. For
<span class="math">\(k=-\nicefrac{n_i}{2},\dots,\nicefrac{n_i}{2}-1\)</span> compute
<span class="math">\(\hat f_{(k+\nicefrac{n}{2})} = (-1)^{(k+\nicefrac{n}{2})} \hat g_{k}\)</span>.
For <span class="math">\(l=0,\dots,n-1\)</span> compute
<span class="math">\(f_l = \sum_{k=0}^{n} \hat f_k {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} kl/n}}}\)</span>
using PFFT. For <span class="math">\(l=-\nicefrac{n_o}{2},\dots,\nicefrac{n_o}{2}-1\)</span>
compute :math:<a href="#id1"><span class="problematic" id="id2">`</span></a>g_l = (-1)^l f_{(l+n/2)} <a href="#id3"><span class="problematic" id="id4">`</span></a>.</p>
<p>Note, that this shift implies that the library deals with pruned FFTs in
a special way, i.e., half of the zeros are added at the beginning of the
inputs and the other half is added at the end.</p>
</div>
<div class="section" id="arbitrary-shifts">
<h3>Arbitrary shifts<a class="headerlink" href="#arbitrary-shifts" title="Permalink to this headline">¶</a></h3>
<p>More general shifts must be done by the user.</p>
<p>In a more general setting, we are interested in the computation of FFTs
with shifted index sets, i.e., assume
<span class="math">\(k_s,l_s\in{\ensuremath{\mathbb{Z}}}\)</span> and compute</p>
<div class="math">
\[g_l = \sum_{k=k_s}^{n_i+k_s-1} \hat g_k {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} kl/n}}},
  \quad l=l_s,\dots,n_o+l_s-1\,.\]</div>
<p>Because of the periodicity of the FFT this can be easily performed by
Alg.&nbsp;[alg:fftshift:sub:<cite>t</cite>ranslation].</p>
<p>[alg:fftshift:sub:<cite>t</cite>ranslation]</p>
<p>[1] =1.1ex For <span class="math">\(k=0,\dots,n_i-1\)</span> assign
<span class="math">\(\hat f_k = \hat g_{(k+k_s\bmod n_i)}\)</span>. For
<span class="math">\(l=0,\dots,n_o-1\)</span> compute
<span class="math">\(f_l = \sum_{k=0}^{n_i} \hat f_k {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} kl/n}}}\)</span>
using PFFT. For <span class="math">\(l=0,\dots,n_o-1\)</span> assign
<span class="math">\(g_l = f_{(l-l_s\bmod n_o)}\)</span>.</p>
<p>However, this involves explicit data movement since the sequence of data
changes. For a our parallel data decomposition the change of data layout
requires data communication. A simple index shift results in the
computation of</p>
<div class="math">
\[\begin{split}\begin{aligned}
  g_{l+l_s}
  &amp;=
    \sum_{k=k_s}^{n_i+k_s-1} \hat g_k {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} k(l+l_s)/n}}}
    =
    \sum_{k=0}^{n_i-1} \hat g_{k+k_s} {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} (k+k_s)(l+l_s)/n}}} \\
  &amp;=
    {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} k_sl/n}}} \sum_{k=0}^{n_i-1} \underbrace{\left(\hat g_{k+k_s}{\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} (k+k_s)l_s/n}}}\right)}_{=: \hat f_k} {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} kl/n}}}\end{aligned}\end{split}\]</div>
<p>for all <span class="math">\(l=0,\dots,n_o-1\)</span>. The resulting
Alg.&nbsp;[alg:fftshift:sub:<cite>m</cite>odulation] preserves the sequence of data at
the price of some extra computation.</p>
<p>[alg:fftshift:sub:<cite>m</cite>odulation]</p>
<p>[1] =1.1ex For <span class="math">\(k=0,\dots,n_i-1\)</span> compute
<span class="math">\(\hat f_k = \hat g_{(k+k_s)} {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} (k+k_s)l_s/n}}}\)</span>.
For <span class="math">\(l=0,\dots,n_o-1\)</span> compute
<span class="math">\(f_l = \sum_{k=0}^{n_i} \hat f_k {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} kl/n}}}\)</span>
using PFFT. For <span class="math">\(l=0,\dots,n_o-1\)</span> compute
<span class="math">\(g_{(l+l_s)} = f_l {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} k_sl/n}}}\)</span>.</p>
<p>The special case <span class="math">\(k_s=-\frac{n_i}{2}, l_s=-\frac{n_o}{2}\)</span>
corresponds to the shifts the arrays ()</p>
<p>[1] =1.1ex For <span class="math">\(k=0,\dots,n_i-1\)</span> compute
<span class="math">\(\hat f_k = \hat g_{(k-\nicefrac{n_i}{2})} {{\ensuremath{\mathrm{e}}}}^{+\pi{\ensuremath{\text{\scriptsize{i}}}}(k-\nicefrac{n_i}{2})n_o/n}\)</span>.
For <span class="math">\(l=0,\dots,n_o-1\)</span> compute
<span class="math">\(f_l = \sum_{k=0}^{n_i} \hat f_k {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} kl/n}}}\)</span>
using PFFT. For <span class="math">\(l=0,\dots,n_o-1\)</span> compute
<span class="math">\(g_{(l-\nicefrac{n_o}{2})} = f_l {{\ensuremath{\mathrm{e}}}}^{+\pi{\ensuremath{\text{\scriptsize{i}}}}n_i l/n}\)</span>.</p>
</div>
</div>
<div class="section" id="parallel-pruned-fft">
<h2>Parallel pruned FFT<a class="headerlink" href="#parallel-pruned-fft" title="Permalink to this headline">¶</a></h2>
<p>Within PFFT we define a pruned FFT as</p>
<div class="math">
\[g_l = \sum_{k=0}^{n_i-1} \hat g_{k} {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} kl/n}}}, \quad l=0,\dots,n_o-1.\]</div>
<p>Formally, this is equivallent to the following regular size <span class="math">\(n\)</span>
FFT</p>
<div class="math">
\[f_l = \sum_{k=0}^{n-1} \hat f_{k} {\ensuremath{\mathrm{e}^{-2\pi{{\ensuremath{\text{\scriptsize{i}}}}} kl/n}}}, \quad l=0,\dots,n,\]</div>
<p>with</p>
<div class="math">
\[\begin{split}\hat g_k :=
  \begin{cases}
  \hat f_k, &amp;: k=0,\dots,n_1-1, \\
  0         &amp;: k=n_i,\dots,n-1,
  \end{cases}\end{split}\]</div>
<p>and <span class="math">\(f_l := g_l\)</span>, <span class="math">\(k=0,\dots,n_o-1\)</span>. I.e., we add
<span class="math">\(n-n_i\)</span> zeros at the end of the input array and throw away
<span class="math">\(n-n_o\)</span> entries at the end of the output array.</p>
<p>The definition of pruned FFT changes for <code class="docutils literal"><span class="pre">PFFT_SHIFTED_IN</span></code> and
<code class="docutils literal"><span class="pre">PFFT_SHIFTED_OUT</span></code>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Advanced Features</a><ul>
<li><a class="reference internal" href="#how-to-deal-with-fft-index-shifts-in-parallel">How to Deal with FFT Index Shifts in Parallel</a><ul>
<li><a class="reference internal" href="#shift-with-half-the-fft-size">Shift with half the FFT size</a></li>
<li><a class="reference internal" href="#arbitrary-shifts">Arbitrary shifts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#parallel-pruned-fft">Parallel pruned FFT</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="install.html"
                        title="previous chapter">Installation and linking</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="interface.html"
                        title="next chapter">Interface Layers of the PFFT Library</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/features.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="interface.html" title="Interface Layers of the PFFT Library"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation and linking"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PFFT 1.0.8 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Michael Pippig.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>